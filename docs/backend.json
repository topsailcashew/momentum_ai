{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Elvo application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Task)"
        },
        "title": {
          "type": "string",
          "description": "Title of the task."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the task."
        },
        "energyLevel": {
          "type": "string",
          "description": "The energy level associated with the task (Low, Medium, High)."
        },
        "priority": {
          "type": "string",
          "description": "The priority of the task."
        },
        "completed": {
          "type": "boolean",
          "description": "Indicates whether the task is completed or not."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Task)"
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "energyLevel",
        "priority",
        "completed",
        "categoryId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Category)"
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        }
      },
      "required": [
        "id",
        "userId",
        "name"
      ]
    },
    "EnergyRating": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EnergyRating",
      "type": "object",
      "description": "Represents a user's self-reported energy level at a specific time.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the EnergyRating entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N EnergyRating)"
        },
        "energyLevel": {
          "type": "string",
          "description": "The user's reported energy level (Low, Medium, High)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the energy level was reported.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "energyLevel",
        "timestamp"
      ]
    },
    "MomentumScore": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MomentumScore",
      "type": "object",
      "description": "Represents a user's daily momentum score.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MomentumScore entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N MomentumScore)"
        },
        "date": {
          "type": "string",
          "description": "The date for which the momentum score is calculated.",
          "format": "date-time"
        },
        "score": {
          "type": "number",
          "description": "The calculated momentum score for the day."
        },
        "streakBonus": {
          "type": "number",
          "description": "The streak bonus applied to the score."
        },
        "momentumPoints": {
          "type": "number",
          "description": "The total momentum points earned for the day."
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "score",
        "streakBonus",
        "momentumPoints"
      ]
    },
    "Streak": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Streak",
      "type": "object",
      "description": "Represents a user's streak of consecutive days of completing tasks that match their energy level.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Streak entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Streak)"
        },
        "startDate": {
          "type": "string",
          "description": "The date the streak started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The date the streak ended, if applicable. Null if the streak is still active.",
          "format": "date-time"
        },
        "length": {
          "type": "number",
          "description": "The length of the streak in days."
        }
      },
      "required": [
        "id",
        "userId",
        "startDate",
        "length"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection of user profiles.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Collection of tasks owned by a specific user. Denormalized userId for Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "taskId",
              "description": "The unique identifier for the task."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Collection of categories owned by a specific user. Denormalized userId for Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "categoryId",
              "description": "The unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/energyRatings/{energyRatingId}",
        "definition": {
          "entityName": "EnergyRating",
          "schema": {
            "$ref": "#/backend/entities/EnergyRating"
          },
          "description": "Collection of energy ratings reported by a specific user. Denormalized userId for Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "energyRatingId",
              "description": "The unique identifier for the energy rating."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/momentumScores/{momentumScoreId}",
        "definition": {
          "entityName": "MomentumScore",
          "schema": {
            "$ref": "#/backend/entities/MomentumScore"
          },
          "description": "Collection of momentum scores calculated for a specific user. Denormalized userId for Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "momentumScoreId",
              "description": "The unique identifier for the momentum score."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/streaks/{streakId}",
        "definition": {
          "entityName": "Streak",
          "schema": {
            "$ref": "#/backend/entities/Streak"
          },
          "description": "Collection of streaks tracked for a specific user. Denormalized userId for Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "streakId",
              "description": "The unique identifier for the streak."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to follow the principles of Authorization Independence and Structural Segregation. Path-based ownership is used for private user data (Tasks, Categories, EnergyRatings, MomentumScores, and Streaks). Each user has their own collection for these entities, enforcing that only the user has access to their respective data. There are no global roles. Each entity follows a `users/{userId}/<entityName>` pattern, where `<entityName>` will be tasks, categories, energyRatings, momentumScores, streaks.\n\n*   **Authorization Independence:** By using path-based ownership (`/users/{userId}/tasks/{taskId}`), the security rules can directly verify that the `userId` matches the `request.auth.uid`, without needing to read any parent documents. This ensures that authorization checks are atomic and independent.\n*   **Structural Segregation:** Each collection under `/users/{userId}` (e.g., `/users/{userId}/tasks`) only contains documents related to that specific user. This simplifies security rules, as all documents in a collection share the same security posture (i.e., only the owner can read/write).\n*   **QAPs Support:** The path-based ownership structure inherently supports secure `list` operations. Rules can easily enforce that a user can only list documents within their own `/users/{userId}` path, preventing unauthorized access to other users' data. By storing roles directly in the database and relying solely on `request.auth.uid`, the design avoids complex custom claims, enabling simple and robust security rules."
  }
}
